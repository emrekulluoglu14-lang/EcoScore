<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ® OYUN SÄ°TESÄ° - Ã‡ALIÅžIYOR</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* TEMEL STÄ°LLER */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* HEADER */
        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #6a11cb;
        }
        
        nav button {
            margin-left: 10px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .giris-btn {
            background: #4CAF50;
            color: white;
        }
        
        .kayit-btn {
            background: #2196F3;
            color: white;
        }
        
        /* HERO */
        .hero {
            background: white;
            padding: 40px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .hero h1 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .oyun-btn {
            background: #FF5722;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            margin: 20px 0;
        }
        
        /* BÄ°Z KÄ°MÄ°Z */
        .hakkimizda {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        /* KULLANICI PANEL */
        .kullanici-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        
        .bilgi-kartlari {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .kart {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        /* SIRALAMA */
        .siralama {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #6a11cb;
            color: white;
        }
        
        /* ANKET */
        .anket {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        
        .soru {
            margin-bottom: 25px;
        }
        
        .soru h4 {
            margin-bottom: 10px;
        }
        
        .secenek {
            margin: 5px 0;
        }
        
        .anket-gonder {
            background: #4CAF50;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }
        
        .modal-icerik {
            background: white;
            margin: 5% auto;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            border-radius: 10px;
        }
        
        .modal input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .modal button {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #6a11cb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <header>
            <div class="logo">ðŸŽ® OYUN DÃœNYASI</div>
            <nav>
                <button class="giris-btn" onclick="girisModalAc()">GiriÅŸ Yap</button>
                <button class="kayit-btn" onclick="kayitModalAc()">KayÄ±t Ol</button>
            </nav>
        </header>
        
        <!-- HERO -->
        <section class="hero">
            <h1>Oyun MacerasÄ± BaÅŸlÄ±yor!</h1>
            <p>Oyna, puan kazan, sÄ±ralamada yÃ¼ksel!</p>
            <button class="oyun-btn" onclick="oyunuAc()">OYUNU AÃ‡</button>
        </section>
        
        <!-- BÄ°Z KÄ°MÄ°Z -->
        <section class="hakkimizda">
            <h2>Biz Kimiz?</h2>
            <p>Oyun platformuyuz. Streak sistemi ve sÄ±ralama ile eÄŸlence sunuyoruz.</p>
        </section>
        
        <!-- KULLANICI PANEL -->
        <section class="kullanici-panel" id="kullaniciPanel">
            <h2>Profilim</h2>
            <div class="bilgi-kartlari">
                <div class="kart">
                    <h3>KullanÄ±cÄ± AdÄ±</h3>
                    <p id="kullaniciAdi">-</p>
                </div>
                <div class="kart">
                    <h3>Puan</h3>
                    <p id="puan">0</p>
                </div>
                <div class="kart">
                    <h3>Streak</h3>
                    <p id="streak">0 gÃ¼n</p>
                </div>
            </div>
        </section>
        
        <!-- SIRALAMA -->
        <section class="siralama" id="siralama">
            <h2>Liderlik Tablosu</h2>
            <table id="siralamaTablosu">
                <thead>
                    <tr>
                        <th>SÄ±ra</th>
                        <th>KullanÄ±cÄ±</th>
                        <th>Puan</th>
                        <th>Streak</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="4" style="text-align:center;padding:20px;">GiriÅŸ yapÄ±nca gÃ¶rÃ¼necek</td></tr>
                </tbody>
            </table>
        </section>
        
        <!-- ANKET -->
        <section class="anket" id="anket">
            <h2>GÃ¼nlÃ¼k Anket (100 Puan)</h2>
            <div id="sorular"></div>
            <button class="anket-gonder" onclick="anketGonder()">Anketi GÃ¶nder (100 Puan)</button>
        </section>
    </div>
    
    <!-- GÄ°RÄ°Åž MODAL -->
    <div class="modal" id="girisModal">
        <div class="modal-icerik">
            <h2>GiriÅŸ Yap</h2>
            <input type="email" id="girisEmail" placeholder="Email" required>
            <input type="password" id="girisSifre" placeholder="Åžifre" required>
            <button onclick="girisYap()" style="background:#4CAF50;color:white;" id="girisButton">
                GiriÅŸ Yap
            </button>
            <button onclick="modalKapat('girisModal')" style="background:#f44336;color:white;">
                Ä°ptal
            </button>
        </div>
    </div>
    
    <!-- KAYIT MODAL -->
    <div class="modal" id="kayitModal">
        <div class="modal-icerik">
            <h2>KayÄ±t Ol</h2>
            <input type="email" id="kayitEmail" placeholder="Email" required>
            <input type="password" id="kayitSifre" placeholder="Åžifre" required>
            <input type="text" id="kayitAdi" placeholder="KullanÄ±cÄ± AdÄ±" required>
            <button onclick="kayitOl()" style="background:#2196F3;color:white;" id="kayitButton">
                KayÄ±t Ol
            </button>
            <button onclick="modalKapat('kayitModal')" style="background:#f44336;color:white;">
                Ä°ptal
            </button>
        </div>
    </div>

    <script>
        // APPS SCRIPT URL'SÄ°NÄ° BURAYA YAPIÅžTIR
        // Apps Script'i deploy ettiÄŸinde alacaÄŸÄ±n URL'yi buraya yapÄ±ÅŸtÄ±r
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby9xPpQXftcCLhXQpxfQwNvUh2j4TkFv_UaLrP1uVp8tS5CFk-WJYvbFJhPq0Fg8Mjt/exec';
        
        let mevcutKullanici = null;
        let callbackId = 0;
        
        // APPS SCRIPT'E Ä°STEK GÃ–NDER
        function callGoogleScript(action, params, callback) {
            callbackId++;
            const callbackName = 'callback_' + callbackId;
            
            window[callbackName] = function(response) {
                delete window[callbackName];
                document.head.removeChild(script);
                callback(response);
            };
            
            const urlParams = new URLSearchParams({
                callback: callbackName,
                action: action,
                ...params
            });
            
            const script = document.createElement('script');
            script.src = APPS_SCRIPT_URL + '?' + urlParams.toString();
            document.head.appendChild(script);
            
            // Timeout
            setTimeout(() => {
                if (window[callbackName]) {
                    delete window[callbackName];
                    if (document.head.contains(script)) {
                        document.head.removeChild(script);
                    }
                    callback({ success: false, message: 'Timeout error' });
                }
            }, 10000);
        }
        
        // MODAL Ä°ÅžLEMLERÄ°
        function girisModalAc() {
            document.getElementById('girisModal').style.display = 'block';
        }
        
        function kayitModalAc() {
            document.getElementById('kayitModal').style.display = 'block';
        }
        
        function modalKapat(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // GÄ°RÄ°Åž YAP - Ã‡ALIÅžIYOR
        function girisYap() {
            const email = document.getElementById('girisEmail').value.trim();
            const sifre = document.getElementById('girisSifre').value;
            
            if (!email || !sifre) {
                alert('Email ve ÅŸifre gerekli!');
                return;
            }
            
            const btn = document.getElementById('girisButton');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="loading"></span> GiriÅŸ yapÄ±lÄ±yor...';
            btn.disabled = true;
            
            callGoogleScript('girisYap', { email, sifre }, function(response) {
                btn.innerHTML = originalText;
                btn.disabled = false;
                
                console.log('GiriÅŸ yanÄ±tÄ±:', response);
                
                if (response.success) {
                    mevcutKullanici = response.kullanici;
                    modalKapat('girisModal');
                    kullaniciBilgileriniGoster();
                    siralamayiYukle();
                    anketiYukle();
                    alert('HoÅŸ geldin ' + mevcutKullanici.adi + '!');
                } else {
                    alert('HATA: ' + response.message);
                }
            });
        }
        
        // KAYIT OL - Ã‡ALIÅžIYOR
        function kayitOl() {
            const email = document.getElementById('kayitEmail').value.trim();
            const sifre = document.getElementById('kayitSifre').value;
            const adi = document.getElementById('kayitAdi').value.trim();
            
            if (!email || !sifre || !adi) {
                alert('TÃ¼m alanlarÄ± doldurun!');
                return;
            }
            
            const btn = document.getElementById('kayitButton');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="loading"></span> Kaydediliyor...';
            btn.disabled = true;
            
            callGoogleScript('kayitOl', { email, sifre, kullaniciAdi: adi }, function(response) {
                btn.innerHTML = originalText;
                btn.disabled = false;
                
                console.log('KayÄ±t yanÄ±tÄ±:', response);
                
                if (response.success) {
                    mevcutKullanici = response.kullanici;
                    modalKapat('kayitModal');
                    kullaniciBilgileriniGoster();
                    siralamayiYukle();
                    anketiYukle();
                    alert('KayÄ±t baÅŸarÄ±lÄ±! HoÅŸ geldin ' + mevcutKullanici.adi + '!');
                } else {
                    alert('HATA: ' + response.message);
                }
            });
        }
        
        // KULLANICI BÄ°LGÄ°LERÄ°NÄ° GÃ–STER
        function kullaniciBilgileriniGoster() {
            if (!mevcutKullanici) return;
            
            document.getElementById('kullaniciPanel').style.display = 'block';
            document.getElementById('siralama').style.display = 'block';
            document.getElementById('anket').style.display = 'block';
            
            document.getElementById('kullaniciAdi').textContent = mevcutKullanici.adi;
            document.getElementById('puan').textContent = mevcutKullanici.puan;
            document.getElementById('streak').textContent = mevcutKullanici.streak + ' gÃ¼n';
        }
        
        // SIRALAMAYI YÃœKLE
        function siralamayiYukle() {
            callGoogleScript('siralamayiGetir', {}, function(siralama) {
                const tbody = document.querySelector('#siralamaTablosu tbody');
                
                if (!siralama || siralama.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;padding:40px;">HenÃ¼z sÄ±ralama yok</td></tr>';
                    return;
                }
                
                let html = '';
                siralama.forEach(function(kullanici) {
                    const isMe = mevcutKullanici && kullanici.email === mevcutKullanici.email;
                    
                    html += '<tr>' +
                            '<td>' + kullanici.sira + '</td>' +
                            '<td>' + kullanici.adi + (isMe ? ' (Siz)' : '') + '</td>' +
                            '<td>' + kullanici.puan + '</td>' +
                            '<td>' + kullanici.streak + ' gÃ¼n</td>' +
                            '</tr>';
                });
                
                tbody.innerHTML = html;
            });
        }
        
        // ANKETÄ° YÃœKLE
        function anketiYukle() {
            callGoogleScript('anketGetir', {}, function(response) {
                const sorularDiv = document.getElementById('sorular');
                let html = '';
                
                response.sorular.forEach(function(soru, index) {
                    html += '<div class="soru">' +
                            '<h4>' + (index + 1) + '. ' + soru.soru + '</h4>';
                    
                    soru.secenekler.forEach(function(secenek) {
                        html += '<div class="secenek">' +
                                '<input type="radio" name="soru' + soru.id + '" value="' + secenek + '" required>' +
                                '<label>' + secenek + '</label>' +
                                '</div>';
                    });
                    
                    html += '</div>';
                });
                
                sorularDiv.innerHTML = html;
            });
        }
        
        // ANKET GÃ–NDER
        function anketGonder() {
            if (!mevcutKullanici) {
                alert('Ã–nce giriÅŸ yap!');
                return;
            }
            
            // TÃ¼m sorular cevaplanmÄ±ÅŸ mÄ±?
            for (let i = 1; i <= 5; i++) {
                if (!document.querySelector('input[name="soru' + i + '"]:checked')) {
                    alert('TÃ¼m sorularÄ± cevapla!');
                    return;
                }
            }
            
            if (confirm('100 puan kazanmak iÃ§in anketi gÃ¶nder?')) {
                callGoogleScript('puanEkle', {
                    email: mevcutKullanici.email,
                    puanMiktar: 100
                }, function(response) {
                    if (response.success) {
                        mevcutKullanici.puan = response.yeniPuan;
                        kullaniciBilgileriniGoster();
                        siralamayiYukle();
                        alert('100 puan kazandÄ±n! Toplam: ' + response.yeniPuan + ' puan');
                    } else {
                        alert('Hata: ' + response.message);
                    }
                });
            }
        }
        
        // OYUNU AÃ‡
        function oyunuAc() {
            if (!mevcutKullanici) {
                alert('Ã–nce giriÅŸ yap!');
                girisModalAc();
                return;
            }
            
            // BURAYA OYUN URL'NÄ° YAZ
            const oyunUrl = 'https://example.com/oyununuz';
            window.open(oyunUrl, '_blank');
        }
        
        // MODAL DIÅžINA TIKLAYINCA KAPAT
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        };
    </script>
</body>
</html>
