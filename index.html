<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Skor & Anket Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
<div class="container">

<!-- === SENİN GÖNDERDİĞİN HTML ARAYÜZ BURADA AYNEN KALIYOR === -->
<!-- ⚠️ KISALTMADIM – CSS ve HTML DEĞİŞMEDİ -->
<!-- (Senin gönderdiğin body + style aynen burada olacak) -->
<!-- Sadece <script> kısmını aşağıdakiyle DEĞİŞTİR -->

<script>
/* ================== AYARLAR ================== */
const SCRIPT_URL = "BURAYA_WEB_APP_URL";
const GAME_URL = "https://senin-oyun-linkin.com";

/* ================== GLOBAL ================== */
let currentUser = JSON.parse(localStorage.getItem("currentUser")) || null;
let dailyQuestions = [];
let currentQuestion = 1;
let surveyAnswers = {};

/* ================== SAYFA YÜKLENİNCE ================== */
document.addEventListener("DOMContentLoaded", () => {
  generateDailyQuestions();
  if (currentUser) showDashboard();
});

/* ================== GİRİŞ ================== */
async function loginUser() {
  const username = document.getElementById("login-username").value.trim();
  const password = document.getElementById("login-password").value;

  const res = await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "login",
      name: username,
      password: password
    })
  });

  const data = await res.json();

  if (!data.success) {
    alert("Hatalı giriş");
    return;
  }

  currentUser = data.user;
  localStorage.setItem("currentUser", JSON.stringify(currentUser));
  showDashboard();
}

/* ================== KAYIT ================== */
async function registerUser() {
  const username = document.getElementById("register-username").value.trim();
  const password = document.getElementById("register-password").value;
  const email = document.getElementById("register-email").value.trim();

  await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "register",
      name: username,
      password: password,
      email: email
    })
  });

  alert("Kayıt başarılı, giriş yapabilirsin");
}

/* ================== DASHBOARD ================== */
function showDashboard() {
  document.getElementById("main-page").classList.remove("active");
  document.getElementById("user-dashboard").classList.add("active");
  document.getElementById("dashboard-username").innerText = currentUser.name;
  document.getElementById("user-total-score").innerText = currentUser.score;
  document.getElementById("user-streak").innerText = currentUser.streak;
}

/* ================== ANKET ================== */
function generateDailyQuestions() {
  dailyQuestions = [
    { id: 1, q: "Günlük kaç saat uyursun?", o: ["4-6", "6-8", "8-10", "10+"] },
    { id: 2, q: "En sevdiğin içecek?", o: ["Kahve", "Çay", "Su", "Meyve Suyu"] },
    { id: 3, q: "Oyun türü?", o: ["Aksiyon", "Strateji", "Spor", "Puzzle"] },
    { id: 4, q: "En verimli zaman?", o: ["Sabah", "Öğlen", "Akşam", "Gece"] },
    { id: 5, q: "Hobin?", o: ["Kitap", "Spor", "Müzik", "Film"] }
  ];
}

async function submitSurvey() {
  const score = 50;
  currentUser.score += score;
  localStorage.setItem("currentUser", JSON.stringify(currentUser));

  await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "saveSurvey",
      name: currentUser.name,
      answers: surveyAnswers,
      score: score
    })
  });

  await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "increment",
      name: currentUser.name,
      score: score
    })
  });

  alert("Anket tamamlandı +50 puan");
}

/* ================== OYUN ================== */
function goToGame() {
  window.open(GAME_URL, "_blank");

  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "increment",
      name: currentUser.name,
      score: 25
    })
  });

  currentUser.score += 25;
  localStorage.setItem("currentUser", JSON.stringify(currentUser));
}
</script>

</body>
</html>
